Using gpu device 0: GRID K520 (CNMeM is disabled)
/home/ubuntu/anaconda/lib/python2.7/site-packages/sklearn/cross_validation.py:412: Warning: The least populated class in y has only 4 members, which is too few. The minimum number of labels for any class cannot be less than n_folds=5.
  % (min_labels, self.n_folds)), Warning)
# Neural Network with 1300966 learnable parameters

## Layer information

  #  name        size
---  --------  ------
  0  input      10079
  1  dropout    10079
  2  hidden1      128
  3  dropout1     128
  4  hidden2       64
  5  dropout2      64
  6  output        38

  epoch    train loss    valid loss    train/val    valid acc  dur
-------  ------------  ------------  -----------  -----------  -----
      1       [36m3.18751[0m       [32m2.73487[0m      1.16551      0.28531  2.36s
      2       [36m2.57351[0m       [32m2.21105[0m      1.16393      0.40510  2.36s
      3       [36m2.23701[0m       [32m1.91478[0m      1.16829      0.52917  2.35s
      4       [36m2.05293[0m       [32m1.73538[0m      1.18298      0.56427  2.36s
      5       [36m1.92320[0m       [32m1.61317[0m      1.19219      0.58036  2.36s
      6       [36m1.83242[0m       [32m1.51913[0m      1.20623      0.59401  2.36s
      7       [36m1.76590[0m       [32m1.45092[0m      1.21708      0.60172  2.36s
      8       [36m1.71814[0m       [32m1.39500[0m      1.23164      0.61307  2.36s
      9       [36m1.68037[0m       [32m1.35563[0m      1.23955      0.61552  2.36s
     10       [36m1.63749[0m       [32m1.30978[0m      1.25020      0.62533  2.26s
     11       [36m1.60481[0m       [32m1.27942[0m      1.25433      0.62955  2.29s
     12       [36m1.57908[0m       [32m1.25516[0m      1.25807      0.63507  2.35s
     13       [36m1.56004[0m       [32m1.22632[0m      1.27213      0.64486  2.35s
     14       [36m1.52841[0m       [32m1.20800[0m      1.26524      0.64241  2.36s
     15       [36m1.51384[0m       [32m1.18588[0m      1.27656      0.64976  2.34s
     16       [36m1.48763[0m       [32m1.16551[0m      1.27638      0.65424  2.36s
     17       [36m1.47568[0m       [32m1.15566[0m      1.27692      0.65148  2.36s
     18       [36m1.45995[0m       [32m1.14464[0m      1.27546      0.65132  2.36s
     19       [36m1.44735[0m       [32m1.12592[0m      1.28548      0.65875  2.35s
     20       [36m1.42850[0m       [32m1.11452[0m      1.28173      0.65809  2.34s
     21       [36m1.41661[0m       [32m1.10092[0m      1.28676      0.66366  2.36s
     22       [36m1.40398[0m       [32m1.09426[0m      1.28304      0.66361  2.35s
     23       [36m1.38940[0m       [32m1.08902[0m      1.27582      0.66132  2.35s
     24       [36m1.38787[0m       [32m1.07179[0m      1.29491      0.67000  2.36s
     25       [36m1.37311[0m       1.07778      1.27402      0.66418  2.35s
     26       [36m1.36319[0m       [32m1.05893[0m      1.28732      0.66856  2.35s
     27       [36m1.35217[0m       [32m1.05620[0m      1.28022      0.66606  2.36s
     28       [36m1.34622[0m       1.06236      1.26719      0.66424  2.35s
     29       [36m1.33747[0m       [32m1.04179[0m      1.28382      0.67043  2.36s
     30       [36m1.32888[0m       [32m1.03832[0m      1.27983      0.67444  2.37s
     31       [36m1.31900[0m       [32m1.03496[0m      1.27445      0.67080  2.36s
     32       [36m1.31788[0m       [32m1.01985[0m      1.29223      0.67866  2.36s
     33       [36m1.30361[0m       1.02215      1.27537      0.67392  2.35s
     34       [36m1.29973[0m       1.02529      1.26767      0.67366  2.33s
     35       [36m1.29795[0m       [32m1.01317[0m      1.28107      0.67580  2.37s
     36       [36m1.28892[0m       [32m1.00173[0m      1.28669      0.67986  2.36s
     37       [36m1.27846[0m       1.01374      1.26114      0.67205  2.36s
     38       [36m1.27228[0m       1.00461      1.26645      0.67694  2.31s
     39       [36m1.26697[0m       [32m0.99422[0m      1.27435      0.67918  2.34s
     40       [36m1.25669[0m       [32m0.98647[0m      1.27393      0.68344  2.36s
     41       [36m1.25613[0m       0.99071      1.26791      0.67783  2.34s
     42       [36m1.24560[0m       [32m0.96626[0m      1.28910      0.68838  2.31s
     43       [36m1.23889[0m       0.97121      1.27562      0.68382  2.36s
     44       [36m1.23569[0m       0.97465      1.26783      0.68073  2.36s
     45       [36m1.22578[0m       [32m0.96318[0m      1.27264      0.68773  2.35s
     46       [36m1.22140[0m       0.98081      1.24530      0.67724  2.33s
     47       [36m1.21525[0m       0.96355      1.26123      0.68479  2.36s
     48       [36m1.20757[0m       [32m0.96218[0m      1.25503      0.68436  2.36s
     49       1.20886       0.96232      1.25619      0.68325  2.36s
     50       [36m1.19882[0m       0.96738      1.23924      0.68115  2.36s
     51       [36m1.19734[0m       [32m0.94966[0m      1.26080      0.68677  2.34s
     52       [36m1.18634[0m       [32m0.94418[0m      1.25647      0.68939  2.34s
     53       [36m1.18564[0m       [32m0.94276[0m      1.25763      0.68897  2.32s
     54       [36m1.17272[0m       0.95690      1.22555      0.68033  2.35s
     55       1.17544       0.94533      1.24343      0.68562  2.37s
     56       [36m1.17028[0m       [32m0.93024[0m      1.25804      0.69255  2.35s
     57       [36m1.16836[0m       0.93236      1.25312      0.69186  2.35s
     58       [36m1.15798[0m       0.93478      1.23878      0.69009  2.37s
     59       1.15920       0.93342      1.24188      0.69040  2.35s
     60       [36m1.14526[0m       [32m0.92989[0m      1.23161      0.69246  2.28s
     61       [36m1.13944[0m       [32m0.92559[0m      1.23105      0.69113  2.33s
     62       [36m1.13747[0m       [32m0.90980[0m      1.25024      0.69859  2.34s
     63       [36m1.13646[0m       0.93086      1.22088      0.69029  2.36s
     64       [36m1.12385[0m       0.94038      1.19510      0.68394  2.35s
     65       [36m1.12236[0m       0.91304      1.22925      0.69654  2.34s
     66       [36m1.12157[0m       0.91853      1.22105      0.69364  2.31s
     67       [36m1.11987[0m       0.91125      1.22894      0.69627  2.35s
     68       [36m1.10985[0m       [32m0.90016[0m      1.23294      0.70073  2.35s
     69       [36m1.10476[0m       [32m0.89881[0m      1.22913      0.70114  2.35s
     70       [36m1.10010[0m       [32m0.89483[0m      1.22939      0.69983  2.36s
     71       [36m1.09726[0m       0.92158      1.19062      0.69304  2.32s
     72       [36m1.09296[0m       0.90344      1.20978      0.69741  2.32s
     73       [36m1.08217[0m       0.90920      1.19025      0.69634  2.36s
     74       1.08218       0.90006      1.20234      0.70028  2.36s
     75       [36m1.08091[0m       0.90462      1.19487      0.69847  2.36s
     76       [36m1.07811[0m       0.92086      1.17076      0.69267  2.36s
     77       [36m1.07766[0m       [32m0.88981[0m      1.21112      0.69998  2.36s
     78       [36m1.06755[0m       [32m0.88329[0m      1.20860      0.70470  2.36s
     79       [36m1.06155[0m       0.88651      1.19746      0.70390  2.35s
     80       [36m1.05421[0m       0.89617      1.17635      0.69807  2.34s
     81       1.06195       0.89180      1.19079      0.70224  2.36s
     82       [36m1.04715[0m       0.88631      1.18147      0.70345  2.36s
     83       [36m1.04000[0m       0.88852      1.17049      0.70113  2.35s
     84       1.04577       [32m0.87021[0m      1.20174      0.70677  2.36s
     85       1.04070       0.87577      1.18833      0.70592  2.34s
     86       [36m1.03013[0m       0.89339      1.15306      0.69988  2.35s
     87       [36m1.02920[0m       0.87530      1.17582      0.70535  2.30s
     88       [36m1.02544[0m       0.88775      1.15510      0.70135  2.32s
     89       [36m1.01340[0m       0.87725      1.15519      0.70394  2.35s
     90       1.02204       0.87318      1.17049      0.70762  2.34s
     91       1.01621       [32m0.86861[0m      1.16993      0.70974  2.33s
     92       [36m1.01286[0m       0.87458      1.15810      0.70448  2.36s
     93       [36m1.00325[0m       [32m0.86234[0m      1.16341      0.71022  2.35s
     94       1.00617       [32m0.85786[0m      1.17289      0.71323  2.31s
     95       [36m0.99758[0m       0.86547      1.15265      0.70856  2.36s
     96       [36m0.98961[0m       0.86019      1.15046      0.71191  2.28s
     97       [36m0.98756[0m       0.86830      1.13734      0.70682  2.32s
     98       0.98910       0.88146      1.12211      0.70220  2.35s
     99       [36m0.98528[0m       0.86236      1.14254      0.70943  2.33s
    100       [36m0.98448[0m       [32m0.85704[0m      1.14869      0.70988  2.35s
    101       [36m0.97587[0m       0.86812      1.12412      0.70850  2.35s
    102       [36m0.97566[0m       [32m0.84624[0m      1.15293      0.71550  2.35s
    103       [36m0.97099[0m       0.86730      1.11954      0.70443  2.34s
    104       [36m0.96519[0m       0.84862      1.13737      0.71468  2.35s
    105       [36m0.96177[0m       0.85737      1.12177      0.71156  2.35s
    106       0.96293       0.84945      1.13358      0.71217  2.36s
    107       [36m0.95696[0m       0.85671      1.11702      0.71291  2.34s
    108       0.95880       0.86947      1.10274      0.70699  2.32s
    109       [36m0.95503[0m       [32m0.83960[0m      1.13749      0.71861  2.30s
    110       [36m0.94912[0m       0.85469      1.11048      0.71062  2.35s
    111       [36m0.94483[0m       0.85202      1.10893      0.71133  2.35s
    112       0.94609       0.84351      1.12161      0.71600  2.35s
    113       [36m0.94029[0m       0.84474      1.11310      0.71474  2.28s
    114       [36m0.93737[0m       0.85322      1.09863      0.71074  2.35s
    115       0.93789       0.84129      1.11483      0.71599  2.35s
    116       [36m0.92856[0m       [32m0.82847[0m      1.12081      0.72133  2.35s
    117       [36m0.92589[0m       0.82986      1.11571      0.71850  2.35s
    118       [36m0.92225[0m       0.85910      1.07351      0.70882  2.35s
    119       0.92352       [32m0.82595[0m      1.11813      0.72093  2.35s
    120       [36m0.91380[0m       0.83151      1.09897      0.71875  2.34s
    121       0.91789       0.85252      1.07668      0.71156  2.34s
    122       0.91643       0.85472      1.07219      0.71121  2.29s
    123       [36m0.91291[0m       0.83536      1.09283      0.71805  2.35s
    124       [36m0.90391[0m       0.84279      1.07252      0.71583  2.35s
    125       [36m0.90252[0m       0.83905      1.07563      0.71583  2.35s
    126       [36m0.89089[0m       0.84340      1.05631      0.71425  2.35s
    127       0.90225       [32m0.82074[0m      1.09931      0.72442  2.35s
    128       0.89420       0.82676      1.08157      0.71972  2.35s
    129       0.89868       0.83901      1.07112      0.71649  2.34s
    130       0.89455       0.84615      1.05720      0.71290  2.35s
    131       0.89292       0.83916      1.06406      0.71743  2.34s
    132       [36m0.88681[0m       0.84228      1.05288      0.71625  2.35s
    133       0.89034       0.83956      1.06048      0.71578  2.34s
    134       [36m0.87898[0m       0.82076      1.07093      0.72133  2.35s
    135       [36m0.87574[0m       [32m0.81764[0m      1.07106      0.72328  2.35s
    136       0.87639       0.84837      1.03303      0.71423  2.32s
    137       0.87841       0.82184      1.06884      0.72088  2.35s
    138       [36m0.86554[0m       [32m0.81033[0m      1.06812      0.72389  2.35s
    139       0.86870       0.81602      1.06456      0.72456  2.34s
    140       [36m0.86530[0m       0.82226      1.05235      0.72112  2.35s
    141       [36m0.86482[0m       0.83701      1.03323      0.71573  2.35s
    142       [36m0.85797[0m       0.83042      1.03318      0.71880  2.34s
    143       0.85914       [32m0.79397[0m      1.08208      0.73330  2.35s
    144       [36m0.85728[0m       0.82991      1.03299      0.71935  2.35s
    145       [36m0.85402[0m       0.81431      1.04876      0.72540  2.35s
    146       [36m0.84680[0m       0.81250      1.04222      0.72625  2.35s
    147       [36m0.84177[0m       0.81644      1.03102      0.72425  2.34s
    148       0.84694       0.82755      1.02343      0.72158  2.30s
    149       0.84893       0.79559      1.06705      0.73114  2.32s
    150       0.84201       0.79849      1.05451      0.72962  2.19s
    151       [36m0.83949[0m       0.81826      1.02594      0.72625  2.34s
    152       0.84414       0.81100      1.04087      0.72737  2.35s
    153       [36m0.83359[0m       0.80707      1.03286      0.72878  2.35s
    154       0.84013       0.81564      1.03003      0.72475  2.35s
    155       [36m0.83078[0m       0.82762      1.00381      0.72236  2.35s
    156       [36m0.82773[0m       0.81486      1.01579      0.72625  2.35s
    157       0.82858       0.80435      1.03011      0.72977  2.35s
    158       [36m0.81908[0m       0.80058      1.02311      0.73057  2.36s
    159       0.82306       0.80776      1.01894      0.72908  2.35s
    160       0.81958       0.80579      1.01711      0.72876  2.31s
    161       [36m0.81801[0m       0.80321      1.01843      0.72913  2.34s
    162       [36m0.81294[0m       [32m0.79369[0m      1.02426      0.73441  2.35s
    163       0.81786       0.80326      1.01818      0.72927  2.35s
    164       0.81653       0.80574      1.01339      0.73041  2.36s
    165       0.81807       [32m0.78200[0m      1.04612      0.73597  2.36s
    166       0.81852       0.78673      1.04041      0.73486  2.36s
    167       0.81566       0.82379      0.99014      0.72354  2.35s
    168       0.81640       0.79640      1.02511      0.73326  2.36s
    169       [36m0.81147[0m       0.81066      1.00100      0.72738  2.34s
    170       0.81197       [32m0.77465[0m      1.04818      0.74102  2.35s
    171       [36m0.80428[0m       0.80431      0.99996      0.73206  2.35s
    172       0.81038       0.79202      1.02318      0.73366  2.35s
    173       [36m0.80031[0m       0.79831      1.00251      0.73274  2.35s
    174       0.80071       0.80144      0.99909      0.73078  2.34s
    175       0.80168       0.80654      0.99397      0.72986  2.35s
    176       0.80760       0.80454      1.00380      0.73000  2.35s
    177       0.80308       0.81586      0.98434      0.73064  2.32s
    178       0.80459       0.80438      1.00027      0.73286  2.35s
    179       [36m0.79921[0m       0.81122      0.98519      0.73104  2.35s
    180       [36m0.79603[0m       0.83822      0.94966      0.72229  2.34s
    181       0.79642       0.80984      0.98343      0.72850  2.33s
    182       [36m0.79393[0m       0.81022      0.97989      0.73003  2.29s
    183       0.79780       0.81324      0.98101      0.72757  2.35s
    184       [36m0.79279[0m       0.83265      0.95212      0.72161  2.35s
    185       [36m0.79025[0m       0.79986      0.98798      0.72998  2.35s
    186       0.79092       0.80981      0.97668      0.72932  2.35s
    187       [36m0.78674[0m       0.80467      0.97772      0.73208  2.28s
    188       0.78760       0.81224      0.96967      0.72717  2.36s
    189       [36m0.78312[0m       0.80780      0.96946      0.72606  2.35s
    190       [36m0.78256[0m       0.83271      0.93978      0.72161  2.30s
    191       0.79171       0.80234      0.98674      0.73142  2.30s
    192       0.78830       0.80088      0.98428      0.73060  2.30s
    193       0.79401       0.79677      0.99653      0.73328  2.35s
    194       0.78554       0.81288      0.96637      0.72666  2.36s
    195       0.79075       0.81795      0.96675      0.72265  2.32s
Will train until validation_0 error hasn't decreased in 25 rounds.
[0]	validation_0-mlogloss:3.092186
[1]	validation_0-mlogloss:2.794405
[2]	validation_0-mlogloss:2.603863
[3]	validation_0-mlogloss:2.436373
[4]	validation_0-mlogloss:2.303786
[5]	validation_0-mlogloss:2.205883
[6]	validation_0-mlogloss:2.119522
[7]	validation_0-mlogloss:2.037747
[8]	validation_0-mlogloss:1.988530
[9]	validation_0-mlogloss:1.912887
[10]	validation_0-mlogloss:1.862282
[11]	validation_0-mlogloss:1.811832
[12]	validation_0-mlogloss:1.761558
[13]	validation_0-mlogloss:1.710374
[14]	validation_0-mlogloss:1.671952
[15]	validation_0-mlogloss:1.629135
[16]	validation_0-mlogloss:1.588634
[17]	validation_0-mlogloss:1.554787
[18]	validation_0-mlogloss:1.523957
[19]	validation_0-mlogloss:1.490517
[20]	validation_0-mlogloss:1.462534
[21]	validation_0-mlogloss:1.434323
[22]	validation_0-mlogloss:1.400492
[23]	validation_0-mlogloss:1.388069
[24]	validation_0-mlogloss:1.367414
[25]	validation_0-mlogloss:1.351280
[26]	validation_0-mlogloss:1.326564
[27]	validation_0-mlogloss:1.320821
[28]	validation_0-mlogloss:1.296975
[29]	validation_0-mlogloss:1.288027
[30]	validation_0-mlogloss:1.267135
[31]	validation_0-mlogloss:1.251621
[32]	validation_0-mlogloss:1.244409
[33]	validation_0-mlogloss:1.237898
[34]	validation_0-mlogloss:1.228345
[35]	validation_0-mlogloss:1.211153
[36]	validation_0-mlogloss:1.194182
[37]	validation_0-mlogloss:1.184829
[38]	validation_0-mlogloss:1.185842
[39]	validation_0-mlogloss:1.186958
[40]	validation_0-mlogloss:1.175128
[41]	validation_0-mlogloss:1.176529
[42]	validation_0-mlogloss:1.165667
[43]	validation_0-mlogloss:1.158755
[44]	validation_0-mlogloss:1.157820
[45]	validation_0-mlogloss:1.155079
[46]	validation_0-mlogloss:1.142812
[47]	validation_0-mlogloss:1.147526
[48]	validation_0-mlogloss:1.142956
[49]	validation_0-mlogloss:1.133331
[50]	validation_0-mlogloss:1.144474
[51]	validation_0-mlogloss:1.131289
[52]	validation_0-mlogloss:1.131088
[53]	validation_0-mlogloss:1.120784
[54]	validation_0-mlogloss:1.120531
[55]	validation_0-mlogloss:1.127071
[56]	validation_0-mlogloss:1.133905
[57]	validation_0-mlogloss:1.125372
[58]	validation_0-mlogloss:1.130059
[59]	validation_0-mlogloss:1.152811
[60]	validation_0-mlogloss:1.159283
[61]	validation_0-mlogloss:1.177752
[62]	validation_0-mlogloss:1.210750
[63]	validation_0-mlogloss:1.220083
[64]	validation_0-mlogloss:1.213487
[65]	validation_0-mlogloss:1.238297
[66]	validation_0-mlogloss:1.247889
[67]	validation_0-mlogloss:1.288059
[68]	validation_0-mlogloss:1.317624
[69]	validation_0-mlogloss:1.334515
[70]	validation_0-mlogloss:1.328223
[71]	validation_0-mlogloss:1.368015
[72]	validation_0-mlogloss:1.384174
[73]	validation_0-mlogloss:1.409487
[74]	validation_0-mlogloss:1.438585
[75]	validation_0-mlogloss:1.440228
[76]	validation_0-mlogloss:1.468447
[77]	validation_0-mlogloss:1.494541
[78]	validation_0-mlogloss:1.487761
[79]	validation_0-mlogloss:1.529941
Stopping. Best iteration:
[54]	validation_0-mlogloss:1.120531

Early stopping.
Best valid loss was 0.774646 at epoch 170.
Loaded parameters to layer 'hidden1' (shape 10079x128).
Loaded parameters to layer 'hidden1' (shape 128).
Loaded parameters to layer 'hidden2' (shape 128x64).
Loaded parameters to layer 'hidden2' (shape 64).
Loaded parameters to layer 'output' (shape 64x38).
Loaded parameters to layer 'output' (shape 38).
Traceback (most recent call last):
  File "Walmart_NN_XGB_Ensembl.py", line 217, in <module>
    y_probas_avg = (y_xgb_test_predictions + y_nn_test_preditions)/2
NameError: name 'y_nn_test_preditions' is not defined
